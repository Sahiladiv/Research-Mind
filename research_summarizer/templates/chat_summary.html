{% extends 'base.html' %}
{% block title %}Chat About Paper{% endblock %}

{% block content %}
<div class="row">
    <!-- Chat Area -->
    <div class="col-md-5">
        <div class="card shadow-sm mb-3">
            <div class="card-header bg-dark text-white d-flex justify-content-between align-items-center">
                <h6 class="mb-0">Ask Questions About the Paper</h6>

                <!-- Language Model Selector -->
                <form method="POST" action="{% url 'set_lm' %}" class="ms-2">
                    {% csrf_token %}
                    <select class="form-select form-select-sm" name="selected_lm" onchange="this.form.submit()" style="width: 160px;">
                        <option value="gpt-4o" {% if request.session.selected_lm == 'gpt-4o' %}selected{% endif %}>GPT-4o (Fastest)</option>
                        <option value="gpt-4-turbo" {% if request.session.selected_lm == 'gpt-4-turbo' %}selected{% endif %}>GPT-4 Turbo</option>
                        <option value="gpt-4" {% if request.session.selected_lm == 'gpt-4' %}selected{% endif %}>GPT-4</option>
                        <option value="gpt-3.5-turbo" {% if request.session.selected_lm == 'gpt-3.5-turbo' %}selected{% endif %}>GPT-3.5 Turbo</option>
                    </select>
                </form>

            </div>

            <div class="card-body" style="height: 600px; overflow-y: auto;" id="chat-box">
                {% if chat_history %}
                    {% for message in chat_history %}
                        <div><strong>{{ message.role|capfirst }}:</strong> {{ message.content }}</div>
                    {% endfor %}
                {% else %}
                    <p class="text-muted">No conversation yet. Ask your first question below.</p>
                {% endif %}
            </div>

            <div class="card-footer">
                <form method="POST">
                    {% csrf_token %}
                    <div class="input-group">
                        <input type="text" name="question" class="form-control" placeholder="Ask something..." required>
                        <button class="btn btn-primary" type="submit">Send</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- PDF Viewer -->
    <div class="col-md-7">
        <div class="card shadow-sm">
            <div class="card-header bg-secondary text-white">
                <h6 class="mb-0">PDF Viewer</h6>
            </div>
            <div class="card-body p-0" style="height: 700px;">
                <iframe src="{{ pdf_url }}" width="100%" height="100%" style="border: none;"></iframe>
            </div>
        </div>
    </div>
</div>
{% endblock %}
